pipeline:
  ruby_build:
    image: ruby:2.2.2
    environment:
      - RAILS_ENV=test
    commands:
      - echo $${EMAIL_HOST}
      - echo $${EMAIL_PORT}
      - echo $${EMAIL_USER_NAME}
      - echo $${EMAIL_PASSWORD}
      - bundle install
      - bundle exec rake db:migrate
      - bundle exec rake db:seed
      - bundle exec rspec spec
    secrets: [ email_host, email_port, email_user_name, email_password ]
  notify:
    image: drillster/drone-email
    host: $${EMAIL_HOST}
    port: $${EMAIL_PORT}
    username: $${EMAIL_USER_NAME}
    password: $${EMAIL_PASSWORD}
    from: messages@voonik.com
    recipients: [naveen.s@voonik.com, lokanadham.m@voonik.com]
services:
  database:
    image: mysql:5.7.14   
    environment:
      - MYSQL_DATABASE=assessment_service
      - MYSQL_ALLOW_EMPTY_PASSWORD=yes

  redis:
    image: redis